<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tamil Nadu Temples â€” Moksha</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">

<style>
:root{
  --lotus:#c27193;
  --gold:#d4af37;
  --deep:#3b1d28;
  --ivory:#fff8f9;
  --paper:#fff8f6;
  --muted:#f0dbe0;
}

/* Base */
*{box-sizing:border-box}
body{margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(180deg,#fff3f5 0%,#fff8f9 62%);color:#312125;line-height:1.45}
a{color:inherit}

/* Hero (keeps identical look to index) */
.hero{
  position:relative;height:62vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;
  background-image:url('https://subha-sahukar.github.io/moksha/images/hero_temple_bg.jpg');
  background-size:cover;background-position:center;border-bottom:4px solid var(--gold);overflow:hidden;
}
.hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(59,29,40,0.35),rgba(59,29,40,0.78));z-index:0}
.hero h1,.hero p,.state-menu{position:relative;z-index:2}
.hero h1{font-family:'Playfair Display',serif;color:var(--gold);font-size:2.6rem;margin:0 0 .4rem;text-shadow:0 6px 20px rgba(0,0,0,0.45);letter-spacing:0.6px}
.hero p{max-width:820px;margin:0 auto 1rem;color:var(--ivory);text-shadow:0 2px 8px rgba(0,0,0,0.5);font-size:1.05rem}

/* state menu same as index */
.state-menu{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap}
.state-menu a{color:#fff;text-decoration:none;font-weight:500;padding-bottom:4px;border-bottom:2px solid transparent;transition:all .25s}
.state-menu a:hover{color:var(--gold);border-bottom:2px solid var(--gold);text-shadow:0 0 6px rgba(212,175,55,.5)}
.state-menu a.active{color:var(--gold);border-bottom:2px solid var(--gold)}

/* Container */
.container{
  display:flex;gap:0;min-height:100vh;
  background-image:url('https://subha-sahukar.github.io/moksha/images/floral_stone_bg.png');
  background-repeat:repeat;background-position:center;background-size:contain;
}

/* Sidebar */
.sidebar{width:250px;padding:1rem;background:rgba(255,255,255,.94);border-right:1px solid rgba(0,0,0,0.04)}
.sidebar h2{font-family:'Playfair Display',serif;color:var(--deep);margin:0 0 .75rem}
.district-btn{display:block;width:100%;background:none;border:none;padding:.65rem .6rem;margin:.32rem 0;text-align:left;border-left:3px solid transparent;color:#412a2f;font-weight:500;border-radius:6px;cursor:pointer;transition:all .2s}
.district-btn:hover{background:rgba(194,113,147,.06);transform:translateX(2px)}
.district-btn.active{background:linear-gradient(90deg,#f6dfe7,#fff2f3);border-left:3px solid var(--gold);color:var(--deep)}

/* hamburger (mobile) */
.hamburger{display:none;position:fixed;left:14px;top:14px;z-index:9999;background:none;border:none;font-size:1.6rem;color:var(--gold);cursor:pointer}

/* Content area: left = temple grid, right = map/circuits */
.content-area{flex:1;padding:2rem;display:grid;grid-template-columns:1fr 360px;gap:1.5rem;align-items:start}
@media(max-width:1100px){.content-area{grid-template-columns:1fr;padding:1rem}}
@media(max-width:900px){.hamburger{display:block} .sidebar{position:fixed;left:0;top:0;height:100%;transform:translateX(-110%);transition:transform .28s;z-index:999;background:var(--paper);box-shadow:4px 0 20px rgba(0,0,0,.12)} .sidebar.open{transform:translateX(0)}}

/* District summary */
.district-summary{background:linear-gradient(180deg,var(--paper),#fff);border-radius:10px;border-left:4px solid var(--gold);padding:1.2rem;margin-bottom:1rem;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.district-summary h2{font-family:'Playfair Display',serif;color:var(--lotus);margin:0 0 .5rem}
.district-summary p{margin:0;color:#3a2130}
.district-more{display:none;margin-top:.8rem;color:#3a2130}
.read-more{display:inline-block;margin-top:.8rem;background:none;border:1px solid rgba(59,29,40,.06);padding:.35rem .6rem;border-radius:6px;color:var(--deep);cursor:pointer}

/* Temple grid */
.temple-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1.25rem}
.temple-card{background:linear-gradient(180deg,#fff,#fff7f6);border-radius:12px;border:1px solid rgba(212,175,55,.15);overflow:hidden;box-shadow:0 8px 22px rgba(0,0,0,.06);transition:transform .25s,box-shadow .25s}
.temple-card:hover{transform:translateY(-6px);box-shadow:0 12px 34px rgba(0,0,0,.1)}
.temple-card img{width:100%;height:160px;object-fit:cover;display:block}
.temple-card .info{padding:12px}
.temple-card h3{font-family:'Playfair Display',serif;color:#6f2d3a;margin:0 0 6px}
.temple-card p{color:#3b2a2a;font-size:.92rem;margin:0 0 4px}

/* Right column */
.right-column{display:flex;flex-direction:column;gap:1rem}
.map-panel{background:rgba(255,255,255,.95);border-radius:10px;padding:12px;border:1px solid rgba(0,0,0,.04);box-shadow:0 8px 18px rgba(0,0,0,.06)}
.map-controls{display:flex;gap:.5rem;align-items:center;justify-content:space-between;margin-bottom:.6rem}
.map-toggle{background:none;border:1px solid rgba(59,29,40,.08);padding:.35rem .6rem;border-radius:6px;cursor:pointer}
.map-iframe{width:100%;height:300px;border:0;border-radius:6px}

/* circuits */
.circuits{background:linear-gradient(180deg,#fff,#fff8f6);border-radius:10px;padding:12px;border:1px solid rgba(0,0,0,.04)}
.circuits h3{margin:0 0 .6rem;font-family:'Playfair Display',serif;color:var(--lotus)}
.circuit-grid{display:grid;grid-template-columns:1fr;gap:.8rem}
.circuit-card{background:linear-gradient(180deg,#fff,#fff6f4);padding:.8rem;border-radius:8px;border:1px solid rgba(212,175,55,.12);cursor:pointer}
.circuit-card h4{margin:0;color:#5c2732}

/* story */
.story-section{grid-column:1/-1;background:linear-gradient(to top,#2f1920,#2b1419);color:var(--ivory);padding:3rem 2rem;margin-top:1.5rem;border-top:4px solid rgba(212,175,55,.15)}
.story-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem}
.story-card{background:rgba(255,255,255,.04);padding:1rem;border-radius:8px;border:1px solid rgba(212,175,55,.08)}
.story-card h3{color:var(--gold);font-family:'Playfair Display',serif}

/* visitor badge */
.visitor-badge{display:inline-block;padding:.25rem .6rem;border-radius:20px;background:rgba(0,0,0,.06);font-size:.9rem;color:#2f2030;border:1px solid rgba(0,0,0,.04)}

/* pilgrim (mobile) style toggles */
.pilgrim-toggle{display:inline-block;margin-left:.6rem;background:transparent;border:1px solid rgba(59,29,40,.08);padding:.25rem .5rem;border-radius:6px;cursor:pointer}

/* divider ornament */
.divider{width:100%;height:18px;margin-top:20px;margin-bottom:-6px;background:linear-gradient(90deg, rgba(212,175,55,.05), rgba(212,175,55,.12));border-top:1px solid rgba(212,175,55,.08)}

/* small screens adjustments */
@media(max-width:700px){
  .hero h1{font-size:1.7rem}
  .hero p{font-size:.95rem}
  .map-iframe{height:220px}
}
</style>
</head>

<body>
<button class="hamburger" aria-label="Open districts" onclick="toggleSidebar()">â˜°</button>

<!-- HERO -->
<section class="hero" role="banner" aria-label="Hero: Tamil Nadu Temples">
  <h1>Tamil Nadu Temples</h1>
  <p>Let dawn light the carvings, let bells and birds answer each other.<br>
  Stone, lamp, chant, and sky â€” from Chidambaram to Kanyakumari, each shrine keeps the rhythm of devotion alive.</p>

  <nav class="state-menu" aria-label="State navigation">
    <a href="tamilnadu.html" class="active">Tamil Nadu</a>
    <a href="andhra.html">Andhra Pradesh</a>
    <a href="karnataka.html">Karnataka</a>
    <a href="kerala.html">Kerala</a>
    <a href="#circuits" style="color:#fff;font-weight:500;border-bottom:2px solid transparent;padding-bottom:4px;margin-left:10px">Tourist Circuits</a>
    <span style="margin-left:8px" class="visitor-badge" id="visitorCount">Visitors: â€”</span>
    <button class="pilgrim-toggle" id="pilgrimToggle" title="Pilgrim mode (mobile-friendly)">Pilgrim view</button>
    <button class="pilgrim-toggle" id="audioToggle" title="Play ambient">ðŸ”” Sound</button>
  </nav>
</section>

<!-- MAIN -->
<div class="container">
  <aside class="sidebar" id="sidebar">
    <h2>Districts</h2>
    <div id="districtButtons" aria-label="Districts list"></div>
    <hr style="margin:.8rem 0;border:none;border-top:1px dashed rgba(0,0,0,.04)">
    <div style="font-size:.9rem;color:#5b3b3f">Quick links</div>
    <div style="margin-top:.6rem">
      <a href="index.html" style="text-decoration:none;color:#4b2b32">Home</a> Â·
      <a href="tamilnadu.html#circuits" style="text-decoration:none;color:#4b2b32">Circuits</a>
    </div>
  </aside>

  <div class="content-area" id="contentArea">
    <div class="temple-column" id="leftColumn" style="grid-column:1/2">
      <div id="contentTop"></div>
      <div class="temple-grid" id="templeGrid" aria-live="polite">
        <p id="introText" style="grid-column:1/-1;text-align:center;color:#6a4a4f;font-size:1.05rem;line-height:1.55;padding:1.4rem 0;max-width:720px;margin:0 auto;">
          Chola vimanas, Pandya corridors, Pallava stones â€” Tamil Naduâ€™s temples are time made visible.<br>
          Walk the sacred routes where saints sang, kings built, and devotion shaped destiny.<br><br>
          Begin by choosing a district below â€” each one opens a doorway into history.
        </p>
      </div>

      <div class="divider" aria-hidden="true"></div>

      <section class="story-section" id="heritage">
        <h2 style="text-align:center;color:var(--gold);font-family:'Playfair Display',serif;margin-bottom:1rem">Legends & Heritage of Tamil Nadu</h2>
        <div class="story-grid">
          <div class="story-card"><h3>The Chola Flame of Architecture</h3><p>The Cholas built in granite and gold â€” from Thanjavurâ€™s towering vimana to Gangaikonda Cholapuramâ€™s grandeur, their art turned devotion into dynasty.</p></div>
          <div class="story-card"><h3>The Sacred Cauvery</h3><p>Winding through the delta, the Cauvery nourishes fields and faith alike; along her banks rise countless shrines and melodies of the Nayanmars.</p></div>
          <div class="story-card"><h3>The Madurai Sangam Age</h3><p>Poets once gathered by the Vaigaiâ€™s edge, weaving Tamil into verse that carried gods, kings, and lovers into immortality.</p></div>
          <div class="story-card"><h3>Pilgrimage of the Nayanmars</h3><p>From Appar to Sundarar, saints walked these lands barefoot, turning every step into song and every temple into truth.</p></div>
        </div>
      </section>
    </div>

    <aside class="right-column" id="rightColumn" style="grid-column:2/3">
      <div class="map-panel" id="mapPanel">
        <div class="map-controls">
          <div style="font-weight:600;color:#5b2a33">Map</div>
          <div>
            <button class="map-toggle" id="toggleMapBtn" onclick="toggleMap()">Hide Map</button>
            <button class="map-toggle" onclick="centerMapOnDistrict()">Center on District</button>
          </div>
        </div>
        <iframe id="osmFrame" class="map-iframe" src="https://www.openstreetmap.org/export/embed.html?bbox=76.0%2C8.0%2C80.5%2C13.5&amp;layer=mapnik" title="Map of Tamil Nadu"></iframe>
        <div style="font-size:.85rem;margin-top:.5rem;color:#5b3b3f">Open map â€” toggle to center on selected district.</div>
      </div>

      <div class="circuits" id="circuits">
        <h3>Tourist Circuits</h3>
        <div class="circuit-grid">
          <div class="circuit-card" onclick="scrollToDistrict('Thanjavur')"><h4>Thanjavur Circuit</h4><p>Great Chola sites: Brihadeeswarar, Saraswathi Mahal, bronze craft hubs.</p></div>
          <div class="circuit-card" onclick="scrollToDistrict('Madurai')"><h4>Maduraiâ€“Tirunelveli Circuit</h4><p>Meenakshi, Nava Tirupati and Nellaiappar; festivals & bhakti trails.</p></div>
          <div class="circuit-card" onclick="scrollToDistrict('Kumbakonam')"><h4>Kumbakonam Temple Trail</h4><p>Sarangapani, Nageswaran and a dense cluster of sthalas â€” perfect for a 1â€“2 day pilgrimage.</p></div>
        </div>
      </div>

      <div class="map-panel" style="margin-top:6px">
        <div style="font-weight:600;color:#5b2a33;margin-bottom:.5rem">Kumbakonam â€” Quick Pilgrim Guide</div>
        <div style="font-size:.95rem;color:#3b2a2a">
          <p><b>Highlights:</b> Sarangapani (Divya Desam), Nageswaran (Padal Petra), many sakta & vaishnava sthalas clustered close by.</p>
          <p><b>Pilgrim categories:</b> Divya Desam devotees, Shaivaites (Padal Petra), Murugan routes (Aru Padai Veedu nearby).</p>
          <p style="margin-top:.5rem;"><a href="#circuits" style="color:var(--deep);text-decoration:underline">See circuits</a> Â· <a href="#heritage" style="color:var(--deep);text-decoration:underline">Heritage</a></p>
        </div>
      </div>
    </aside>
  </div>
</div>

<footer style="padding:1rem;text-align:center;background:linear-gradient(180deg,#2f1a20,#1f0f13);color:var(--ivory)">
  <div style="max-width:1000px;margin:0 auto">
    <div style="margin-bottom:.35rem">Â© 2025 Moksha â€” Sacred Circuits of Bharat</div>
    <div style="font-size:.85rem;opacity:.85">A living catalogue of pilgrimage, lovingly curated.</div>
  </div>
</footer>

<script>
/* -----------------------------------------
   Data (inline) â€” keep this in sync / move to JSON later
   ----------------------------------------- */
const temples = [
  {district:"Thanjavur",name:"Brihadeeswarar Temple",deity:"Shiva",category:"Padal Petra Sthalam",festival:"Maha Shivaratri",significance:"Spiritual power",img:"https://upload.wikimedia.org/wikipedia/commons/5/5d/Brihadeeswarar_Temple.jpg"},
  {district:"Thanjavur",name:"Srirangam Ranganathaswamy Temple",deity:"Vishnu",category:"Divya Desam",festival:"Vaikunta Ekadasi",significance:"Removes doshas",img:"https://upload.wikimedia.org/wikipedia/commons/d/d0/Srirangam_Ranganathaswamy_Temple_07.jpg"},
  {district:"Madurai",name:"Meenakshi Amman Temple",deity:"Devi",category:"Shakti Peetham",festival:"Chithirai Festival",significance:"Marriage and family blessings",img:"https://upload.wikimedia.org/wikipedia/commons/5/54/Meenakshi_Amman_temple_tower_1.jpg"},
  {district:"Madurai",name:"Thiruparankundram Murugan Temple",deity:"Murugan",category:"Aru Padai Veedu",festival:"Skanda Sashti",significance:"Victory and courage",img:"https://upload.wikimedia.org/wikipedia/commons/a/a8/Thiruparankundram_temple.jpg"},
  {district:"Kanchipuram",name:"Ekambareswarar Temple",deity:"Shiva",category:"Padal Petra Sthalam",festival:"Karthigai Deepam",significance:"Health and longevity",img:"https://upload.wikimedia.org/wikipedia/commons/0/0d/Ekambareswarar_Temple%2C_Kanchipuram.jpg"},
  {district:"Kanchipuram",name:"Varadharaja Perumal Temple",deity:"Vishnu",category:"Divya Desam",festival:"Brahmotsavam",significance:"Fertility and family welfare",img:"https://upload.wikimedia.org/wikipedia/commons/f/f6/Varadharaja_Perumal_Temple%2C_Kanchipuram.jpg"},
  {district:"Chennai",name:"Kapaleeshwarar Temple",deity:"Shiva",category:"Padal Petra Sthalam",festival:"Maha Shivaratri",significance:"Removes obstacles",img:"https://upload.wikimedia.org/wikipedia/commons/7/72/Kapaleeswarar_temple.jpg"},
  {district:"Chennai",name:"Parthasarathy Temple",deity:"Vishnu",category:"Divya Desam",festival:"Vaikunta Ekadasi",significance:"Relief from doshas",img:"https://upload.wikimedia.org/wikipedia/commons/9/9e/Parthasarathy_temple_tank.jpg"},
  {district:"Tirunelveli",name:"Nellaiappar Temple",deity:"Shiva",category:"Padal Petra Sthalam",festival:"Panguni Uthiram",significance:"Health and prosperity",img:"https://upload.wikimedia.org/wikipedia/commons/8/83/Nellaiappar_temple_gopuram.jpg"},
  {district:"Tirunelveli",name:"Nava Tirupati Temples",deity:"Vishnu",category:"Nava Tirupati",festival:"Various festivals",significance:"Astrological remedies",img:"https://upload.wikimedia.org/wikipedia/commons/4/4c/Alwarthirunagari_temple.jpg"},
  {district:"Kumbakonam",name:"Sarangapani Temple",deity:"Vishnu",category:"Divya Desam",festival:"Chitra Pournami",significance:"Spiritual upliftment",img:"https://upload.wikimedia.org/wikipedia/commons/5/58/Sarangapani_temple_gopuram.jpg"},
  {district:"Kumbakonam",name:"Nageswaran Temple",deity:"Shiva",category:"Padal Petra Sthalam",festival:"Maha Shivaratri",significance:"Removes Sarpa Dosha",img:"https://upload.wikimedia.org/wikipedia/commons/2/23/Nageswaran_Temple%2C_Kumbakonam.jpg"},
  {district:"Dindigul",name:"Palani Murugan Temple",deity:"Murugan",category:"Aru Padai Veedu",festival:"Thaipusam",significance:"Relief from Rahu dosha",img:"https://upload.wikimedia.org/wikipedia/commons/3/3f/Palani_temple.jpg"},
  {district:"Kanyakumari",name:"Kumari Amman Temple",deity:"Devi",category:"Shakti Peetham",festival:"Navaratri",significance:"Fertility and well-being",img:"https://upload.wikimedia.org/wikipedia/commons/2/27/Kanyakumari_Temple.jpg"},
  {district:"Nagapattinam",name:"Soundararajaperumal Temple",deity:"Vishnu",category:"Divya Desam",festival:"Brahmotsavam",significance:"Protection from evil",img:"https://upload.wikimedia.org/wikipedia/commons/a/a8/Thirukannapuram_temple.jpg"}
];

const districtInfo = {
  "Thanjavur": {
    short:"Once the seat of the Chola Empire, this fertile Cauvery delta city cradles art, bronze, and towering vimanas.",
    long:"Thanjavur grew into a centre of temple-building and scholarship under the Cholas. Beyond the Brihadeeswarar temple, the Saraswathi Mahal Library and the Thanjavur palace carry an archival legacy of manuscripts, bronze icons and South Indian musicology. The Cauvery delta's agriculture supported vast temple economies, and local crafts â€” especially bronze casting and classical music â€” still thrive here."
  },
  "Madurai": {
    short:"An ancient city of temples and jasmine, Madurai rose under the Pandyas; the Vaigai River marks its heart.",
    long:"Maduraiâ€™s urban fabric grew around the Meenakshiâ€“Sundareswarar shrine; the city was a cultural hub during the Sangam period. Apart from the great temple, Madurai's markets, classical music traditions, and festivals (Chithirai) shaped Tamil identity. The Nayak-era mandapas and palace compound illustrate later layers of royal patronage."
  },
  "Kanchipuram": {
    short:"Known as the City of Thousand Temples, Kanchi flourished under Pallava and Chola dynasties.",
    long:"Kanchipuramâ€™s templesâ€”both Shaiva and Vaishnavaâ€”became centres of theology, learning and silk weaving. The Varadharaja and Ekambareswarar temples illustrate early Pallava and later Chola architecture, while the town's handloom tradition continues to attract pilgrims and shoppers alike."
  },
  "Chennai": {
    short:"A coastal metropolis with colonial ports and ancient temple pockets, offering a mix of heritage and modernity.",
    long:"Chennai formed around Fort St. George in the colonial era but preserves older spiritual nodes like Kapaleeshwarar and Parthasarathy. The cityâ€™s cultural season (music and dance), coastal festivals, and museums give a metropolitan counterpoint to deeper temple circuits inland."
  },
  "Tirunelveli": {
    short:"By the Tamiraparani River, this southern district holds the Nava Tirupatis and Nellaiappar â€” faith and agriculture woven through its fields.",
    long:"Tirunelveli blends ancient temple life with agrarian rhythms. The Tamiraparani nourishes paddy and pilgrimage towns; Nellaiappar is famous for its twin temple complex and ritual music. The region's festivals and river rituals remain integral to local identity."
  },
  "Kumbakonam": {
    short:"A compact temple city where many Divya Desams and Padal Petra Sthalams cluster â€” perfect for a concentrated pilgrimage.",
    long:"Kumbakonamâ€™s temple density makes it ideal for circuit pilgrims. Sarangapani (a Divya Desam) and Nageswaran (a Padal Petra Sthalam) anchor the town; numerous smaller sthalas, ritual tanks, and festival timings keep the calendar full. Kumbakonam is also known for ritual festivals and historic ghats along local rivers."
  }
};

const districts = Array.from(new Set(temples.map(t => t.district)));

/* Visitor count (localStorage) */
const VISITOR_KEY = 'moksha_tn_visitors';
function updateVisitorCountUI(){
  let count = parseInt(localStorage.getItem(VISITOR_KEY) || '0',10);
  const visitedFlag = localStorage.getItem('moksha_tn_visited');
  if(!visitedFlag){ count = count + 1; localStorage.setItem(VISITOR_KEY, String(count)); localStorage.setItem('moksha_tn_visited','1'); }
  document.getElementById('visitorCount').textContent = `Visitors: ${count}`;
}

/* DOM references */
const districtButtons = document.getElementById('districtButtons');
const templeGrid = document.getElementById('templeGrid');
const contentTop = document.getElementById('contentTop');
const introText = document.getElementById('introText');
const pilgrimToggle = document.getElementById('pilgrimToggle');
const audioToggle = document.getElementById('audioToggle');

/* Build district buttons */
function buildDistrictButtons(){
  // use curated ordering if desired; currently alphabetic-ish as data appears
  districts.forEach(d=>{
    const btn = document.createElement('button');
    btn.className = 'district-btn';
    btn.textContent = d;
    btn.onclick = () => {
      document.querySelectorAll('.district-btn').forEach(x=>x.classList.remove('active'));
      btn.classList.add('active');
      loadDistrict(d);
      centerMapOnDistrict(d);
      // change intro to contextual dynasty phrase
      setDynastyIntro(d);
    };
    districtButtons.appendChild(btn);
  });
}

/* Set dynasty-based intro banner (above temple grid) */
function setDynastyIntro(d){
  const map = {
    "Thanjavur":"Here the Cholas crowned stone with crown-like vimanas. Walk among Rajarajaâ€™s legacy â€” temples that turned devotion into empire.",
    "Kumbakonam":"A compact temple city: Divya Desams and Padal Petra sthalams cluster here. Ritual tanks and festivals keep the calendar full.",
    "Madurai":"A city sung by poets. The Pandya court and Meenakshiâ€™s legends fold into daily lamp-light and festival music.",
    "Kanchipuram":"Pallava rock-cut beginnings and later Chola grandeur â€” Kanchipuram is a campus of early medieval theology and weaving craft.",
    "Tirunelveli":"By the Tamiraparani, saints walked and folkcosm grew; Nava Tirupati and Nellaiappar mark a southern bhakti map.",
    "Chennai":"Where port and temple meet â€” colonial commerce alongside Kapaleeshwararâ€™s ancient lamps, a modern city with old hearts."
  };
  const text = map[d] || "Walk where emperors prayed and saints wandered. Choose a district below to open its chapter.";
  introText.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:#6a4a4f;font-size:1.05rem;line-height:1.55;padding:1.4rem 0;max-width:720px;margin:0 auto;">${text}</p>`;
}

/* Load a selected district (summary + temples) */
function loadDistrict(d){
  // clear
  contentTop.innerHTML = '';
  templeGrid.innerHTML = '';

  // summary
  const summary = document.createElement('div'); summary.className = 'district-summary';
  const info = districtInfo[d] || {short:'', long:''};
  const shortHTML = `<h2>${d}</h2><p>${info.short || ''}</p>`;
  const longHTML = `<div class="district-more" id="more-${d.replace(/\s+/g,'_')}"><p>${info.long || ''}</p></div>`;
  summary.innerHTML = shortHTML + longHTML + `<button class="read-more" data-target="more-${d.replace(/\s+/g,'_')}">Read more</button>`;
  contentTop.appendChild(summary);

  // temples
  const matching = temples.filter(t => t.district === d);
  if(matching.length === 0){
    const p = document.createElement('p'); p.textContent = 'No temples listed for this district yet.'; templeGrid.appendChild(p);
  } else {
    matching.forEach(t => {
      const card = document.createElement('div'); card.className = 'temple-card';
      card.innerHTML = `<img loading="lazy" src="${t.img}" alt="${t.name}"><div class="info"><h3>${t.name}</h3><p><b>Deity:</b> ${t.deity}</p><p><b>Type:</b> ${t.category}</p><p><b>Festival:</b> ${t.festival}</p><p><b>Significance:</b> ${t.significance}</p></div>`;
      templeGrid.appendChild(card);
    });
  }

  // read more wiring
  const rmBtn = summary.querySelector('.read-more'); const moreEl = summary.querySelector('.district-more');
  rmBtn.onclick = () => {
    if(moreEl.style.display === 'block'){ moreEl.style.display = 'none'; rmBtn.textContent = 'Read more'; }
    else { moreEl.style.display = 'block'; rmBtn.textContent = 'Show less'; summary.scrollIntoView({behavior:'smooth', block:'start'}); }
  };
}

/* Map helpers (OpenStreetMap embed) */
let mapVisible = true;
function toggleMap(){
  const frame = document.getElementById('osmFrame'); const btn = document.getElementById('toggleMapBtn');
  if(mapVisible){ frame.style.display='none'; btn.textContent='Show Map'; mapVisible=false; } else { frame.style.display='block'; btn.textContent='Hide Map'; mapVisible=true; }
}
function centerMapOnDistrict(d){
  // center map around known centers if a district provided; else use existing
  const centers = {
    "Thanjavur":[10.7867,79.1378],
    "Madurai":[9.9252,78.1198],
    "Kanchipuram":[12.8342,79.7036],
    "Chennai":[13.0827,80.2707],
    "Tirunelveli":[8.7139,77.6926],
    "Kumbakonam":[10.9630,79.3806]
  };
  const frame = document.getElementById('osmFrame');
  if(!d){ frame.src = frame.src; return; }
  const c = centers[d];
  if(!c) return;
  const lat = c[0], lon = c[1]; const delta = 0.35;
  const west = (lon - delta).toFixed(4), south=(lat - delta).toFixed(4), east=(lon + delta).toFixed(4), north=(lat + delta).toFixed(4);
  frame.src = `https://www.openstreetmap.org/export/embed.html?bbox=${west}%2C${south}%2C${east}%2C${north}&layer=mapnik&marker=${lat}%2C${lon}`;
  if(!mapVisible) toggleMap();
}

/* circuits quick nav */
function scrollToDistrict(name){
  const btns = document.querySelectorAll('.district-btn');
  for(const b of btns){ if(b.textContent.trim() === name){ b.click(); window.scrollTo({top:220,behavior:'smooth'}); break; } }
}

/* sidebar toggle (mobile) */
function toggleSidebar(){ document.getElementById('sidebar').classList.toggle('open'); }

/* Pilgrim mode (mobile) â€” toggles card styling & layout to palm-leaf style */
let pilgrimMode = false;
pilgrimToggle.addEventListener('click', ()=>{
  pilgrimMode = !pilgrimMode;
  if(pilgrimMode){
    document.querySelectorAll('.temple-card').forEach(c => {
      c.style.borderRadius = '6px'; c.style.boxShadow = '0 6px 10px rgba(0,0,0,.06)'; c.style.background = 'linear-gradient(180deg,#fff7f0,#fff2ee)';
      c.querySelector('.info').style.fontSize = '0.98rem';
    });
    pilgrimToggle.textContent = 'Standard view';
  } else {
    document.querySelectorAll('.temple-card').forEach(c => {
      c.style.borderRadius = ''; c.style.boxShadow = ''; c.style.background = '';
      c.querySelector('.info').style.fontSize = '';
    });
    pilgrimToggle.textContent = 'Pilgrim view';
  }
});

/* Visitor counter init */
function initVisitor(){ updateVisitorCountUI(); }

/* Dynasty-based default intro when district loads */
function setDefaultIntro(){
  introText.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:#6a4a4f;font-size:1.05rem;line-height:1.55;padding:1.4rem 0;max-width:720px;margin:0 auto;">
    Walk where emperors prayed and saints wandered. Granite towers rise from rice fields, and stone speaks of Cholas, Pandyas and Pallavas â€” each dynasty carving devotion into eternity.
  </p>`;
}

/* ========== Ambient sound (synthesised tanpura + bell via WebAudio) ========== */
let audioCtx, droneGain, droneOsc1, droneOsc2;
let bellGain;
let audioOn = false;
function initAudio(){
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  droneGain = audioCtx.createGain(); droneGain.gain.value = 0; droneGain.connect(audioCtx.destination);
  // two detuned oscillators for drone
  droneOsc1 = audioCtx.createOscillator(); droneOsc2 = audioCtx.createOscillator();
  droneOsc1.type = 'sine'; droneOsc2.type = 'sine';
  droneOsc1.frequency.value = 130.81; // C3-ish
  droneOsc2.frequency.value = 196.00; // G3-ish (fifth)
  const droneFilter = audioCtx.createBiquadFilter(); droneFilter.type='lowpass'; droneFilter.frequency.value=1000;
  droneOsc1.connect(droneFilter); droneOsc2.connect(droneFilter);
  droneFilter.connect(droneGain);
  droneOsc1.start(); droneOsc2.start();
  // bell (simple FM-ish using oscillator + gain envelope)
  bellGain = audioCtx.createGain(); bellGain.gain.value = 0; bellGain.connect(audioCtx.destination);
}
function toggleAudio(){
  if(!audioCtx) initAudio();
  if(!audioOn){
    // ramp up drone
    droneGain.gain.cancelScheduledValues(audioCtx.currentTime);
    droneGain.gain.linearRampToValueAtTime(0.02, audioCtx.currentTime + 1.2);
    audioOn = true; audioToggle.textContent = 'ðŸ”• Mute';
    // occasional soft bell every ~20s
    bellPulse();
    window._moksha_bell_interval = setInterval(bellPulse, 20000 + Math.random()*10000);
  } else {
    droneGain.gain.cancelScheduledValues(audioCtx.currentTime);
    droneGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.8);
    audioOn = false; audioToggle.textContent = 'ðŸ”” Sound';
    clearInterval(window._moksha_bell_interval);
  }
}
function bellPulse(){
  if(!audioCtx) return;
  const g = audioCtx.createGain(); g.gain.value = 0; g.connect(audioCtx.destination);
  const o = audioCtx.createOscillator(); o.type='sine'; o.frequency.value = 880 + Math.random()*200;
  const f = audioCtx.createBiquadFilter(); f.type='bandpass'; f.frequency.value = 1000 + Math.random()*400;
  o.connect(f); f.connect(g);
  const now = audioCtx.currentTime;
  g.gain.setValueAtTime(0, now);
  g.gain.linearRampToValueAtTime(0.12, now + 0.02);
  g.gain.exponentialRampToValueAtTime(0.0001, now + 2.4);
  o.start(now); o.stop(now + 2.6);
}

/* Initialization: build UI & default */
(function init(){
  buildDistrictButtons();
  initVisitor();
  setDefaultIntro();
  // open a meaningful default district (Thanjavur preferred)
  const defaultDistrict = districts.includes('Thanjavur') ? 'Thanjavur' : districts[0];
  // automatically select its button
  setTimeout(()=> {
    const btns = document.querySelectorAll('.district-btn');
    for(const b of btns){
      if(b.textContent.trim() === defaultDistrict){ b.classList.add('active'); b.click(); break; }
    }
  }, 250);
})();

/* audio toggle control wiring (user gesture: resume audio context on first click) */
audioToggle.addEventListener('click', async ()=>{
  try{ if(!audioCtx) { await (new (window.AudioContext || window.webkitAudioContext)()).resume(); } } catch(e){}
  if(!audioCtx) initAudio();
  toggleAudio();
});

/* pilgrim-mode persist toggle â€” keep simple: clicking toggles current cards formatting (done above) */

/* small helpers */
function updateVisitorCountUI(){ // read and show
  let count = parseInt(localStorage.getItem(VISITOR_KEY) || '0',10);
  const visitedFlag = localStorage.getItem('moksha_tn_visited');
  if(!visitedFlag){ count = count + 1; localStorage.setItem(VISITOR_KEY, String(count)); localStorage.setItem('moksha_tn_visited', '1'); }
  document.getElementById('visitorCount').textContent = `Visitors: ${count}`;
}
</script>
</body>
</html>
